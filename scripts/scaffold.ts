//원본 코드 : var _0x6c7a=["\x75\x73\x65\x20\x73\x74\x72\x69\x63\x74","\x5F\x5F\x65\x73\x4D\x6F\x64\x75\x6C\x65","\x64\x65\x66\x69\x6E\x65\x50\x72\x6F\x70\x65\x72\x74\x79","\x62\x64\x73\x78\x2F\x63\x6F\x6D\x6D\x6F\x6E","\x62\x64\x73\x78\x2F\x65\x76\x65\x6E\x74","\x75\x74\x69\x6C","\x2E\x2E\x2F\x6D\x61\x69\x6E","\x70\x6C\x61\x79\x65\x72","\x43\x41\x4E\x43\x45\x4C","\x69\x73\x50\x6C\x61\x79\x65\x72","\x62\x6C\x6F\x63\x6B\x50\x6F\x73","\x67\x65\x74\x46\x65\x65\x74\x50\x6F\x73","\x67\x65\x74\x4E\x61\x6D\x65\x54\x61\x67","\x79","\x66\x6C\x6F\x6F\x72","\x67\x65\x74\x47\x61\x6D\x65\x54\x79\x70\x65","\x67\x65\x74\x52\x6F\x74\x61\x74\x69\x6F\x6E","\x67\x65\x74\x4E\x65\x74\x77\x6F\x72\x6B\x49\x64\x65\x6E\x74\x69\x66\x69\x65\x72","\x78","\x69\x73\x4E\x75\x6D\x62\x65\x72","\x6E\x61\x6D\x65","\x53\x63\x61\x66\x66\x6F\x6C\x64","\x57\x6F\x72\x6C\x64","\x41\x6E\x74\x69\x43\x68\x65\x61\x74","\x4D\x69\x73\x6D\x61\x74\x63\x68\x20\x48\x65\x61\x64\x20\x52\x6F\x74\x61\x74\x69\x6F\x6E","\x4E\x43\x42\x50\x64\x65\x74\x65\x63\x74\x69\x6F\x6E","\x53\x63\x61\x66\x66\x6F\x6C\x64\x20\x54\x6F\x77\x65\x72\x20\x61\x6E\x64\x20","\x64\x65\x73\x63\x72\x69\x70\x74\x69\x6F\x6E","\x6F\x6E","\x62\x6C\x6F\x63\x6B\x50\x6C\x61\x63\x65","\x65\x76\x65\x6E\x74\x73"];_0x6c7a[0];Object[_0x6c7a[2]](exports,_0x6c7a[1],{value:true});const common_1=require(_0x6c7a[3]);const event_1=require(_0x6c7a[4]);const util_1=require(_0x6c7a[5]);const main_1=require(_0x6c7a[6]);const lastplacedblockposY={};const scaffoldwarn={};event_1[_0x6c7a[30]][_0x6c7a[29]][_0x6c7a[28]]((ev)=>{const _0x2254x8=ev[_0x6c7a[7]];if(!_0x2254x8){return common_1[_0x6c7a[8]]};if(!_0x2254x8[_0x6c7a[9]]()){return};const blockpos=ev[_0x6c7a[10]];const _0x2254xa=_0x2254x8[_0x6c7a[11]]();const _0x2254xb=_0x2254x8[_0x6c7a[12]]();const _0x2254xc=Math[_0x6c7a[14]](_0x2254xa[_0x6c7a[13]]);const blockposy=Math[_0x6c7a[14]](blockpos[_0x6c7a[13]]);const _0x2254xe=_0x2254x8[_0x6c7a[15]]();if(_0x2254xe=== 1){return};if(_0x2254xc- 1=== blockposy|| _0x2254xc- 2=== blockposy){lastplacedblockposY[_0x2254xb]= blockposy;const _0x2254xf=_0x2254x8[_0x6c7a[16]]();const ni=_0x2254x8[_0x6c7a[17]]();if(_0x2254xf[_0x6c7a[18]]< 0){if(!(0,util_1[_0x6c7a[19]])(scaffoldwarn[_0x2254xb])){scaffoldwarn[_0x2254xb]= 0};scaffoldwarn[_0x2254xb]++;if(scaffoldwarn[_0x2254xb]> 2){return (0,main_1[_0x6c7a[25]])(ni,main_1[_0x6c7a[23]][_0x6c7a[22]][_0x6c7a[21]][_0x6c7a[20]],_0x6c7a[24])};setTimeout(async ()=>{scaffoldwarn[_0x2254xb]--;if(scaffoldwarn[_0x2254xb]< 0){scaffoldwarn[_0x2254xb]= 0}},15000);return common_1[_0x6c7a[8]]};if(_0x2254xf[_0x6c7a[18]]< 30){if(lastplacedblockposY[_0x2254xb]+ 1=== blockposy){if(!(0,util_1[_0x6c7a[19]])(scaffoldwarn[_0x2254xb])){scaffoldwarn[_0x2254xb]= 0};scaffoldwarn[_0x2254xb]++;if(scaffoldwarn[_0x2254xb]> 1){return (0,main_1[_0x6c7a[25]])(ni,main_1[_0x6c7a[23]][_0x6c7a[22]][_0x6c7a[21]][_0x6c7a[20]],_0x6c7a[26]+ main_1[_0x6c7a[23]][_0x6c7a[22]][_0x6c7a[21]][_0x6c7a[27]])};setTimeout(()=>{scaffoldwarn[_0x2254xb]--;if(scaffoldwarn[_0x2254xb]< 0){scaffoldwarn[_0x2254xb]= 0}},15000);return common_1[_0x6c7a[8]]}}}})

import { CANCEL } from "bdsx/common";
import { events } from "bdsx/event";
import { NCBPdetection, AntiCheat } from "../main";

const lastplacedblockposY : any = {};
const scaffoldwarn : any = {};

events.blockPlace.on((ev) => {
    const pl = ev.player;

    if (!pl) return CANCEL
    if (!pl.isPlayer()) return
    
    const blockpos = ev.blockPos;
    const feetpos = pl.getFeetPos();
    const plname = pl.getNameTag();
    const ypos = Math.floor(feetpos.y)
    const blockposy = Math.floor(blockpos.y);
    const gamemode = pl.getGameType();

    if (gamemode === 1) return
    
    if (ypos - 1 === blockposy || ypos - 2 === blockposy) {
        lastplacedblockposY[plname] = blockposy;

        const rotation = pl.getRotation();
        const ni = pl.getNetworkIdentifier();

        if (rotation.x < 0) {
            if (!scaffoldwarn[plname].isNumber()) scaffoldwarn[plname] = 0

            scaffoldwarn[plname]++;

            if (scaffoldwarn[plname] > 2) return NCBPdetection(ni, AntiCheat.World.Scaffold.name, 'Mismatch Head Rotation')
            
            setTimeout(async () => {
                scaffoldwarn[plname]--;
                if (scaffoldwarn[plname] < 0) scaffoldwarn[plname] = 0
            }, 15000);

            return CANCEL
        }

        if (rotation.x < 30) {
            if (lastplacedblockposY[plname] + 1 === blockposy) {
                if (!scaffoldwarn[plname].isNumber()) scaffoldwarn[plname] = 0
                
                scaffoldwarn[plname]++;

                if (scaffoldwarn[plname] > 1) return NCBPdetection(ni, AntiCheat.World.Scaffold.name, 'Scaffold Tower and ' + AntiCheat.World.Scaffold.description)

                setTimeout(() => {
                    scaffoldwarn[plname]--;
                    if (scaffoldwarn[plname] < 0) scaffoldwarn[plname] = 0
                }, 15000);

                return CANCEL
            }
        }
    }
})