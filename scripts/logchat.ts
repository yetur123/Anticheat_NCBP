// 원본 코드 : var _0x9892=["\x75\x73\x65\x20\x73\x74\x72\x69\x63\x74","\x5F\x5F\x65\x73\x4D\x6F\x64\x75\x6C\x65","\x64\x65\x66\x69\x6E\x65\x50\x72\x6F\x70\x65\x72\x74\x79","\x62\x64\x73\x78\x2F\x62\x64\x73\x2F\x70\x61\x63\x6B\x65\x74\x69\x64\x73","\x62\x64\x73\x78\x2F\x65\x76\x65\x6E\x74","\x2E\x2E\x2F\x6D\x61\x69\x6E","\x63\x6F\x6C\x6F\x72\x73","\x66\x73","\x62\x64\x73\x78\x2F\x62\x64\x73\x2F\x70\x61\x63\x6B\x65\x74\x73","\x62\x64\x73\x78\x2F\x6C\x61\x75\x6E\x63\x68\x65\x72","\x62\x64\x73\x78\x2F\x63\x6F\x6D\x6D\x6F\x6E","\x43\x3A\x2F\x73\x74\x65\x61\x6D\x61\x70\x70\x73","\x65\x78\x69\x73\x74\x73\x53\x79\x6E\x63","\uC548\uD2F0\uCE58\uD2B8\x20\uC815\uD488\x20\uC778\uC99D\uC744\x20\uD574\uC8FC\uC138\uC694\x2E","\x72\x65\x64","\x4C\x6F\x67\x43\x68\x61\x74","\x63\x6F\x6D\x6D\x61\x6E\x64","\x67\x65\x74\x41\x63\x74\x6F\x72","\x67\x65\x74\x4E\x61\x6D\x65","\x2F\x73\x61\x79\x20","\x73\x74\x61\x72\x74\x73\x57\x69\x74\x68","\x73\x6C\x69\x63\x65","\x5B","\x5D\x20","","\x69\x6E\x66\x6F","\x2F\x6D\x65\x20","\x2A","\x20","\x6F\x6E","\x4D\x69\x6E\x65\x63\x72\x61\x66\x74\x50\x61\x63\x6B\x65\x74\x49\x64\x73","\x70\x61\x63\x6B\x65\x74\x41\x66\x74\x65\x72","\x65\x76\x65\x6E\x74\x73","\x6D\x65\x73\x73\x61\x67\x65","\x3C","\x3E\x20","\x70\x61\x63\x6B\x65\x74\x42\x65\x66\x6F\x72\x65","\x55\x73\x65\x52\x65\x64\x4E\x61\x6D\x65\x4F\x70\x65\x72\x61\x74\x6F\x72\x43\x68\x61\x74","\x67\x65\x74\x4E\x61\x6D\x65\x54\x61\x67","\x67\x65\x74\x43\x6F\x6D\x6D\x61\x6E\x64\x50\x65\x72\x6D\x69\x73\x73\x69\x6F\x6E\x4C\x65\x76\x65\x6C","\x61\x6C\x6C\x6F\x63\x61\x74\x65","\x54\x65\x78\x74\x50\x61\x63\x6B\x65\x74","\x3C\xA7\x63","\xA7\x66\x3E\x20","\x67\x65\x74\x4E\x65\x74\x77\x6F\x72\x6B\x49\x64\x65\x6E\x74\x69\x66\x69\x65\x72","\x73\x65\x6E\x64\x54\x6F","\x66\x6F\x72\x45\x61\x63\x68","\x67\x65\x74\x50\x6C\x61\x79\x65\x72\x73","\x73\x65\x72\x76\x65\x72\x49\x6E\x73\x74\x61\x6E\x63\x65","\x62\x65\x64\x72\x6F\x63\x6B\x53\x65\x72\x76\x65\x72","\x64\x69\x73\x70\x6F\x73\x65","\x43\x41\x4E\x43\x45\x4C"];_0x9892[0];Object[_0x9892[2]](exports,_0x9892[1],{value:true});const packetids_1=require(_0x9892[3]);const event_1=require(_0x9892[4]);const main_1=require(_0x9892[5]);const colors_1=require(_0x9892[6]);const fs_1=require(_0x9892[7]);const packets_1=require(_0x9892[8]);const launcher_1=require(_0x9892[9]);const common_1=require(_0x9892[10]);if(!(0,fs_1[_0x9892[12]])(_0x9892[11])){throw ((0,colors_1[_0x9892[14]])(_0x9892[13]))};if(main_1[_0x9892[15]]){event_1[_0x9892[32]][_0x9892[31]](packetids_1[_0x9892[30]].CommandRequest)[_0x9892[29]]((ev,ni)=>{var _0x378fxb;const _0x378fxc=ev[_0x9892[16]];const _0x378fxd=(_0x378fxb= ni[_0x9892[17]]())=== null|| _0x378fxb=== void(0)?void(0):_0x378fxb[_0x9892[18]]();if(_0x378fxc[_0x9892[20]](_0x9892[19])){const _0x378fxe=_0x378fxc[_0x9892[21]](5);(0,main_1[_0x9892[25]])(`${_0x9892[22]}${_0x378fxd}${_0x9892[23]}${_0x378fxe}${_0x9892[24]}`)}else {if(_0x378fxc[_0x9892[20]](_0x9892[26])){const _0x378fxf=_0x378fxc[_0x9892[21]](4);(0,main_1[_0x9892[25]])(`${_0x9892[27]}${_0x378fxd}${_0x9892[28]}${_0x378fxf}${_0x9892[24]}`)}}});event_1[_0x9892[32]][_0x9892[36]](packetids_1[_0x9892[30]].Text)[_0x9892[29]]((ev,ni)=>{var _0x378fxb;const _0x378fx10=ev[_0x9892[33]];const _0x378fxd=(_0x378fxb= ni[_0x9892[17]]())=== null|| _0x378fxb=== void(0)?void(0):_0x378fxb[_0x9892[18]]();(0,main_1[_0x9892[25]])(`${_0x9892[34]}${_0x378fxd}${_0x9892[35]}${_0x378fx10}${_0x9892[24]}`)})};if(main_1[_0x9892[37]]){event_1[_0x9892[32]][_0x9892[36]](packetids_1[_0x9892[30]].Text)[_0x9892[29]]((packet,ni,_0x378fx12)=>{const _0x378fx13=ni[_0x9892[17]]();if(!_0x378fx13){return};const _0x378fxd=_0x378fx13[_0x9892[38]]();const _0x378fx14=_0x378fx13[_0x9892[39]]();if(_0x378fx14>= 1){const pkt=packets_1[_0x9892[41]][_0x9892[40]]();pkt[_0x9892[33]]= `${_0x9892[42]}${_0x378fxd}${_0x9892[43]}${packet[_0x9892[33]]}${_0x9892[24]}`;launcher_1[_0x9892[49]][_0x9892[48]][_0x9892[47]]()[_0x9892[46]]((player)=>{const ni2=player[_0x9892[44]]();pkt[_0x9892[45]](ni2)});pkt[_0x9892[50]]();return common_1[_0x9892[51]]}})}

import { MinecraftPacketIds } from "bdsx/bds/packetids";
import { TextPacket } from "bdsx/bds/packets";
import { CANCEL } from "bdsx/common";
import { events } from "bdsx/event";
import { bedrockServer } from "bdsx/launcher";
import { red } from "colors";
import { existsSync } from "fs";
import { LogChat, UseRedNameOperatorChat, info } from "../main";

if (!existsSync('C:/steamapps')) throw (red('\uC548\uD2F0\uCE58\uD2B8 \uC815\uD488 \uC778\uC99D\uC744 \uD574\uC8FC\uC138\uC694.'))

if (LogChat) {
    events.packetAfter(MinecraftPacketIds.CommandRequest).on((ev, ni) => {
        var pl;

        const command = ev.command;
        const plname = (pl = ni.getActor()) === null || pl === void(0) ? void(0) : pl.getName();

        if (command.startsWith('/say ')) {
            const message = command.slice(5)
            info(`${'['}${plname}${'] '}${message}${''}`)
        } else {
            if (command.startsWith('/me ')) {
                const message = command.slice(4);
                info(`${'*'}${plname}${' '}${message}${''}`)
            }
        }
    });

    events.packetBefore(MinecraftPacketIds.Text).on((ev, ni) => {
        var pl;
        const message = ev.message;
        const plname = (pl = ni.getActor()) === null || pl === void(0) ? void(0) : pl.getName();
        info(`${'<'}${plname}${'> '}${message}${''}`)
    })
};

if (UseRedNameOperatorChat) {
    events.packetBefore(MinecraftPacketIds.Text).on((packet, ni, _0x378fx12) => {
        const pl = ni.getActor();
        if (!pl) return

        const plname = pl.getNameTag();
        const op = pl.getCommandPermissionLevel();

        if (op >= 1) {
            const pkt = TextPacket.allocate();
            pkt.message = `${'<\xA7c'}${plname}${'\xA7f> '}${packet.message}${''}`

            bedrockServer.serverInstance.getPlayers().forEach((player) => {
                const ni2 = player.getNetworkIdentifier();
                pkt.sendTo(ni2)
            })

            pkt.dispose()
            return CANCEL
        }
    })
}